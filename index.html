<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculatrice Ch√¢teau Marius</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* ========================================
       RESET & BASE
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 75%;
    }

    /* ========================================
       VARIABLES GLOBALES
       ======================================== */
    :root {
      /* Couleurs de fond */
      --bg-primary: #2e2e2e;
      --bg-secondary: #2e2e2e;
      --bg-card: #2e2e2e;
      --bg-input: #2e2e2e;
      
      /* Bordures */
      --border-primary: #9a2243;
      --border-secondary: #b74162;
      
      /* Textes */
      --text-primary: rgb(232, 232, 232);
      --text-secondary: rgb(232, 232, 232);
      --text-light: rgb(232, 232, 232);
      
      /* Focus */
      --focus-purple: #9a2243;
      --focus-orange: #9a2243;
    }

    /* ========================================
       ANIMATIONS
       ======================================== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in;
    }

    /* ========================================
       CONTENEUR PRINCIPAL
       ======================================== */
    .main-container {
      min-height: 100vh;
      background: #2e2e2e;
      padding: 0.75rem;
    }
    @media (min-width: 768px) {
      .main-container {
        padding: 1.5rem;
      }
    }

    /* ========================================
       CARTE PRINCIPALE
       ======================================== */
    .main-card {
      max-width: 60rem;
      margin: 0 auto;
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      border-radius: 0.75rem;
      box-shadow: 0 18.75px 37.5px -9px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--border-secondary);
      overflow: hidden;
    }
    
    .main-padding {
      padding: 1.125rem;
    }
    @media (min-width: 768px) {
      .main-padding {
        padding: 1.5rem;
      }
    }

    /* ========================================
       SECTION BOUTONS (Grille)
       ======================================== */
    .button-section {
      margin-bottom: 1.5rem;
    }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.375rem;
      margin-bottom: 0.375rem;
    }
    @media (max-width: 640px) {
      .button-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ========================================
       BOUTON PRIX/POIDS
       ======================================== */
    .btn-prixpoids { 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5625rem 0.75rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-size: 0.75rem;
      font-weight: 700;
      background: #9a2243;
      cursor: default;
    }

    /* ========================================
       BOUTON G√âN√âRER LIBELL√â
       ======================================== */
    .btn-genererlibelle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.375rem 0.375rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      transition: all 0.2s;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      background: #9a2243;
    }
    .btn-genererlibelle:hover {
      background: #b74162;
    }
    .btn-genererlibelle:disabled {
      background: rgb(107, 108, 110);
      text-decoration: line-through;
      cursor: not-allowed;
    }

    /* ========================================
       BOUTON R√âINITIALISER
       ======================================== */
    .btn-reinitialiser {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5625rem 0.75rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      transition: all 0.2s;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      background: rgb(140, 22, 22);
    }
    .btn-reinitialiser:hover {
      background: rgb(185, 28, 28);
    }

    /* ========================================
       BOUTON CARTE DU CH√ÇTEAU
       ======================================== */
    .btn-cartechateau {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5625rem 0.75rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      transition: all 0.2s;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      background: #9a2243;
    }
    .btn-cartechateau:hover {
      background: #b74162;
    }

    /* ========================================
       BOUTON NOUVEL ARRIVANT
       ======================================== */
    .btn-nouvelarrivant {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5625rem 0.75rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      transition: all 0.2s;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      background: #9a2243;
    }
    .btn-nouvelarrivant:hover {
      background: #b74162;
    }

    /* Popup Nouvel Arrivant */
    .popup-icon-nouvelarrivant { 
      padding: 0.5625rem;
      border-radius: 9999px;
      background: #2e2e2e;
      color: #9a2243;
    }

    /* ========================================
       BOUTON SERVICE PUBLIC
       ======================================== */
    .btn-servicepublic {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
      padding: 0.5625rem 0.75rem;
      color: white;
      border: none;
      border-radius: 0.375rem;
      transition: all 0.2s;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      font-weight: 600;
      font-size: 0.75rem;
      cursor: pointer;
      background: #9a2243;
    }
    .btn-servicepublic:hover {
      background: #b74162;
    }

    /* Popup Service Public */
    .popup-icon-servicepublic { 
      padding: 0.5625rem;
      border-radius: 9999px;
      background: #2e2e2e;
      color: #9a2243;
    }

    /* ========================================
       SELECT R√âDUCTION
       ======================================== */
    .select-reduction {
      width: 100%;
      padding: 0.5625rem 0.75rem;
      border: 1.5px solid var(--border-primary);
      background: var(--bg-input);
      color: var(--text-primary);
      border-radius: 0.375rem;
      outline: none;
      font-weight: 500;
      font-size: 0.75rem;
    }
    .select-reduction:focus {
      border-color: var(--focus-orange);
      box-shadow: 0 0 0 1.5px rgba(249, 115, 22, 0.2);
    }

    /* ========================================
       POPUPS (Structure g√©n√©rale)
       ======================================== */
    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      z-index: 50;
      padding: 0.75rem;
      padding-top: 3.75rem;
    }
    .popup-card {
      background: rgb(30, 41, 59);
      border: 1px solid var(--border-secondary);
      border-radius: 0.5625rem;
      box-shadow: 0 18.75px 37.5px -9px rgba(0, 0, 0, 0.5);
      max-width: 21rem;
      width: 100%;
      padding: 1.125rem;
      transform: scale(1);
      transition: all 0.3s;
    }
    .popup-header {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .popup-title {
      font-weight: 700;
      font-size: 0.9375rem;
      color: var(--text-primary);
      margin-bottom: 0.375rem;
    }
    .popup-text {
      color: var(--text-light);
      line-height: 1.6;
      font-size: 0.75rem;
    }

    /* Popup Info Produit */
    .popup-icon-productinfo { 
      padding: 0.5625rem;
      border-radius: 9999px;
      background: #2e2e2e;
      color: #9a2243;
    }

    /* ========================================
       MESSAGE DE COPIE
       ======================================== */
    .copy-message {
      margin-bottom: 1.125rem;
      padding: 0.75rem;
      background: rgba(1, 58, 24, 0.75);
      border-left: 3px solid rgb(0, 122, 45);
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      gap: 0.375rem;
      color: rgb(255, 255, 255);
      font-size: 0.75rem;
    }

    /* ========================================
       CAT√âGORIES
       ======================================== */
    .categories-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.125rem;
    }
    .category-card {
      background: rgba(51, 65, 85, 0.5);
      border-radius: 0.5625rem;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-primary);
      overflow: hidden;
    }
    .category-header {
      width: 100%;
      padding: 1.125rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background 0.2s;
      background: none;
      border: none;
      cursor: pointer;
    }
    .category-header:hover {
      background: rgb(51, 65, 85);
    }
    .category-title-container {
      display: flex;
      align-items: center;
      gap: 0.5625rem;
    }
    .category-emoji {
      font-size: 1.40625rem;
    }
    .category-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    .category-count {
      font-size: 0.65625rem;
      font-weight: 400;
      color: var(--text-secondary);
      margin-left: 0.375rem;
    }
    .category-icon {
      color: var(--text-secondary);
    }
    .category-content {
      padding: 1.125rem;
      padding-top: 0;
    }

    /* ========================================
       PRODUITS
       ======================================== */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
    @media (max-width: 640px) {
      .product-grid {
        grid-template-columns: 1fr;
      }
    }
    .product-card {
      background: var(--bg-secondary);
      border-radius: 0.375rem;
      padding: 0.75rem;
      box-shadow: 0 3px 4.5px -0.75px rgba(0, 0, 0, 0.2);
      transition: box-shadow 0.3s;
      border: 1px solid var(--border-primary);
    }
    .product-card:hover {
      box-shadow: 0 15px 18.75px -3.75px rgba(0, 0, 0, 0.3);
    }
    .product-header {
      margin-bottom: 0.5625rem;
    }
    .product-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.375rem;
    }
    .product-name {
      font-weight: 700;
      color: #9a2243;
      text-decoration: underline;
      font-size: 1.125rem;
    }
    .product-price {
      font-size: 0.9375rem;
      font-weight: 700;
      color: #c8355c;
    }
    .product-weight {
      font-size: 0.75rem;
      color: #ffffff;
    }

    /* ========================================
       BOUTON INFO PRODUIT
       ======================================== */
    .btn-info-product {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      font-weight: 700;
      font-size: 0.675rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      border: 1.5px solid #9a2243;
      cursor: pointer;
      background: transparent;
      flex-shrink: 0;
    }
    .btn-info-product:hover {
      background: #9a2243;
      transform: scale(1.1);
    }

    /* ========================================
       BOUTON MOINS (-)
       ======================================== */
    .btn-moins {
      width: 1.875rem;
      height: 1.875rem;
      border-radius: 0.375rem;
      font-weight: 700;
      font-size: 0.9375rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      border: none;
      cursor: pointer;
      background: rgb(185, 28, 28);
    }
    .btn-moins:hover {
      background: rgb(220, 38, 38);
      transform: scale(1.1);
    }

    /* ========================================
       INPUT QUANTIT√â
       ======================================== */
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .quantity-input {
      flex: 1;
      padding: 0.375rem 0.5625rem;
      border: 1.5px solid var(--border-primary);
      background: var(--bg-input);
      color: var(--text-primary);
      border-radius: 0.375rem;
      text-align: center;
      font-weight: 700;
      font-size: 0.84375rem;
      outline: none;
    }
    .quantity-input:focus {
      border-color: var(--focus-purple);
      box-shadow: 0 0 0 1.5px rgba(168, 85, 247, 0.2);
    }

    /* ========================================
       BOUTON PLUS (+)
       ======================================== */
    .btn-plus {
      width: 1.875rem;
      height: 1.875rem;
      border-radius: 0.375rem;
      font-weight: 700;
      font-size: 0.9375rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      border: none;
      cursor: pointer;
      background: rgb(0, 87, 32);
    }
    .btn-plus:hover {
      background: rgb(0, 131, 48);
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const Icons = {
      Users: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
      ),
      Building2: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M3 21h18"/><path d="M5 21V7l8-4v18"/><path d="M19 21V11l-6-4"/>
          <path d="M9 9v.01"/><path d="M9 12v.01"/><path d="M9 15v.01"/><path d="M9 18v.01"/>
        </svg>
      ),
      Copy: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
      ),
      FileText: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
        </svg>
      ),
      RotateCcw: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
        </svg>
      ),
      ChevronDown: () => (
        <svg width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      ),
      ChevronRight: () => (
        <svg width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      ),
      CheckCircle: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      ),
      Info: () => (
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
      )
    };

    function OutilDevis() {
      const [cart, setCart] = useState([]);
      const [showInfo, setShowInfo] = useState(null);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [entrepriseSelectionnee, setEntrepriseSelectionnee] = useState('Aucune');
      const [copied, setCopied] = useState(false);
      const [copiedMessage, setCopiedMessage] = useState('');
      const [expandedCategories, setExpandedCategories] = useState({});
      const [quantities, setQuantities] = useState({});

      const products = {
        'Formules': [
          { name: 'Starter pack', price: 250, weight: 7.60, info: "8 moyens jus, 6 grands plats, 4 petits extras" },
          { name: "Morg'an", price: 410, weight: 8.90, info: "15 moyens jus, 8 grands plats, 10 petits extras" },
          { name: 'Tsuki', price: 820, weight: 13.30, info: "20 grands jus, 15 grands plats" },
          { name: "March'Al", price: 1000, weight: 24.60, info: "45 moyens jus, 20 grands plats" },
          { name: 'Castle Marius', price: 1200, weight: 32.20, info: "40 moyens jus, 20 grands plats, 10 petits extras, 10 grands extras, 1 vin" }
        ],
        'Boissons': [
          { name: 'Petit jus', price: 5, weight: 0.450, info: "Jus de pomme/orange/tomate, choux brouhaha, potage √† la citrouille, limonade" },
          { name: 'Moyen jus', price: 10, weight: 0.330, info: "Naples Gius, Juskano, Oasclick, TropiCamak, tomachou fraicheur, orangeade √† la citrouille, smoothie, tomato-tonic, lait" },
          { name: 'Grand jus', price: 20, weight: 0.315, info: "FruitForSub, MultiFruit" }
        ],
        'Plats / Snacks': [
          { name: 'Grand plat', price: 30, weight: 0.510, info: "Symphonie de l'automne, Festin champ√™tre, F√™te des l√©gumes, R√©union potag√®re, Symphonie de boeuf √† la truffe, C√¥te d'agneau croquante, Filet de veau rosmarino, Magret √©pic√© sichuan, Tataki du bout du monde, Tagine des sables, Tikka royale, Curry de ch√®vre tropical, Saint-Jacques au ma√Øs dor√©, Turbot des profondeurs, Cabillaud √† l'herbier, √âveil de l'oc√©an" },
          { name: 'Moyen plat', price: 10, weight: 0.520, info: "Salade de Choux, Ma√Øs √† la cr√®me, Pomme de Terre Saut√©es, Tomate Farcies, La danse V√©g√©tarienne" },
          { name: 'Petit extra', price: 5, weight: 0.200, info: "Fruits, Fromage, Raisins, fromage d'halloween" },
          { name: 'Grand extra', price: 15, weight: 0.500, info: "Cheesecake, salade de Fruit, popcorn, saucisson" }
        ],
        'Vins': [
          { name: 'Vin', price: 30, weight: 1, info: "Mandatorien, Cuve Saint-Monnay, IndySpensable, LaMano Blanc" },
          { name: 'Ancienne cuv√©e', price: 1000, weight: 1, info: "Ann√©es pass√©es" },
          { name: 'Cuv√©e des damn√©s 2023', price: 1000, weight: 1, info: "Cuv√©e des damn√©s 2023" },
          { name: 'Cuv√©e de No√´l 2024', price: 1000, weight: 1, info: "Cuv√©e de No√´l 2024" }
        ],
        'Halloween 2025': [
          { name: 'Soupe √† la citrouille', price: 15, weight: 1, info: "Soupe √† la citrouille" },
          { name: "Fromage de l'Esprit de Minuit", price: 50, weight: 0.30, info: "Fromage de l'Esprit de Minuit" },
          { name: 'Ail', price: 15, weight: 0.10, info: "Ail" },
          { name: 'Cuv√©e des damn√©s 2025', price: 500, weight: 1, info: "Cuv√©e des damn√©s 2025" },
          { name: "Bruschetta de l'Exorciste", price: 100, weight: 0.5, info: "Bruschetta de l'Exorciste" },
          { name: 'C√¥tes Ombre Noires', price: 100, weight: 1, info: "C√¥tes Ombres Noires" },
          { name: 'Rago√ªt Sacr√©', price: 100, weight: 0.5, info: "Rago√ªt Sacr√©" },
          { name: 'Filet Rouge', price: 100, weight: 1, info: "Filet Rouge" }
        ]
      };

      const infoNouvelArrivant = "Starter pack soit : 8 moyens jus, 6 grands plats, 4 petits extras + 1 bouteille de vin √† choix lors du premier passage";
      const infoServicePublic = "14 moyens jus, 8 grands plats (2 viande, 4 v√©g√©s, 2 poisson), 2 grand extras";
      const carteChateauImage = "https://i.ibb.co/Mx9nSRvT/MENU-CM.png";

      const entreprises = [
        { name: "Aucune", reduction: 0, displayName: "R√©duction" },
        { name: "BlueBird", reduction: 20 },
        { name: "DMC", reduction: 0 },
        { name: "NG", reduction: 20 },
        { name: "Carl Jr", reduction: 20 },
        { name: "TN", reduction: 20 },
        { name: "MTP", reduction: 20 },
        { name: "BAUN", reduction: 20 },
        { name: "UPW", reduction: 20 },
        { name: "PAWL", reduction: 20 },
        { name: "YN", reduction: 20 },
        { name: "CM", reduction: 20}
      ];

      const updateQuantity = (product, category, newQuantity) => {
        const qty = Math.max(0, parseInt(newQuantity) || 0);
        const productKey = `${category}-${product.name}`;
        setQuantities(prev => ({ ...prev, [productKey]: qty }));
        const existingItems = cart.filter(item => !(item.category === category && item.name === product.name));
        const newItems = [];
        for (let i = 0; i < qty; i++) {
          newItems.push({ ...product, category, id: `${productKey}-${i}` });
        }
        setCart([...existingItems, ...newItems]);
      };

      const incrementQuantity = (product, category) => {
        const productKey = `${category}-${product.name}`;
        const currentQty = quantities[productKey] || 0;
        updateQuantity(product, category, currentQty + 1);
      };

      const decrementQuantity = (product, category) => {
        const productKey = `${category}-${product.name}`;
        const currentQty = quantities[productKey] || 0;
        if (currentQty > 0) updateQuantity(product, category, currentQty - 1);
      };

      const getQuantity = (product, category) => {
        const productKey = `${category}-${product.name}`;
        return quantities[productKey] || 0;
      };

      const calculateTotal = () => {
        const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
        const entreprise = entreprises.find(e => e.name === entrepriseSelectionnee);
        const reductionPourcent = entreprise ? entreprise.reduction : 0;
        const discount = (subtotal * reductionPourcent) / 100;
        return {
          subtotal: subtotal.toFixed(2),
          discount: discount.toFixed(2),
          total: (subtotal - discount).toFixed(2),
          weight: cart.reduce((sum, item) => sum + item.weight, 0).toFixed(2)
        };
      };

      const copyImageLink = (url) => {
        navigator.clipboard.writeText(url);
        setCopied(true);
        setCopiedMessage("Lien d'image copi√© !");
        setTimeout(() => setCopied(false), 2000);
      };

      const toggleCategory = (category) => {
        setExpandedCategories(prev => ({ ...prev, [category]: !prev[category] }));
      };

      const resetForm = () => {
        setCart([]);
        setQuantities({});
        setEntrepriseSelectionnee('Aucune');
        setShowInfo(null);
        setSelectedProduct(null);
      };

      const generateLibelle = () => {
        const groupedProducts = cart.reduce((acc, item) => {
          const key = item.name;
          if (!acc[key]) acc[key] = 0;
          acc[key] += 1;
          return acc;
        }, {});

        const productsPart = Object.entries(groupedProducts)
          .map(([name, qty]) => `${qty} ${name}`)
          .join(' & ');

        const entreprise = entreprises.find(e => e.name === entrepriseSelectionnee);
        let libelle = '[üè∞CM] ' + productsPart;
        
        if (entreprise && entreprise.reduction > 0) {
          libelle += ` -${entreprise.reduction}% ${entreprise.name}`;
        } else if (entreprise && entreprise.name !== "Aucune") {
          libelle += ` ${entreprise.name}`;
        }

        navigator.clipboard.writeText(libelle);
        setCopied(true);
        setCopiedMessage("Libell√© de facture copi√© !");
        setTimeout(() => setCopied(false), 2000);
      };

      const totals = calculateTotal();
      const categoryEmojis = {
        'Formules': 'üì¶',
        'Boissons': 'ü•§',
        'Plats / Snacks': 'üçΩÔ∏è',
        'Vins': 'üç∑',
        'Halloween 2025': 'üéÉ'
      };

      return (
        <div className="main-container">
          <div className="main-card">
            <div className="main-padding">
              <div className="button-section">
                <div className="button-grid">
                  <div className="btn-prixpoids">
                    {totals.total}$ ({totals.weight} kg)
                  </div>
                  <button onClick={generateLibelle} disabled={cart.length === 0} className="btn-genererlibelle">
                    <Icons.FileText />
                    G√©n√©rer libell√©
                  </button>
                  <button onClick={resetForm} className="btn-reinitialiser">
                    <Icons.RotateCcw />
                    R√©initialiser
                  </button>
                </div>
                <div className="button-grid">
                  <button onClick={() => copyImageLink(carteChateauImage)} className="btn-cartechateau">
                    <Icons.Copy />
                    Carte du Ch√¢teau
                  </button>
                  <button onClick={() => setShowInfo('nouvel-arrivant')} className="btn-nouvelarrivant">
                    <Icons.Users />
                    Nouvel arrivant
                  </button>
                  <button onClick={() => setShowInfo('service-public')} className="btn-servicepublic">
                    <Icons.Building2 />
                    Paniers Service public
                  </button>
                </div>
                <select value={entrepriseSelectionnee} onChange={(e) => setEntrepriseSelectionnee(e.target.value)} className="select-reduction">
                  {entreprises.map((entreprise, idx) => (
                    <option key={idx} value={entreprise.name}>
                      {entreprise.displayName || entreprise.name} {entreprise.reduction > 0 && `(-${entreprise.reduction}%)`}
                    </option>
                  ))}
                </select>
              </div>

              {showInfo === 'nouvel-arrivant' && (
                <div className="popup-overlay" onClick={() => setShowInfo(null)}>
                  <div className="popup-card" onClick={(e) => e.stopPropagation()}>
                    <div className="popup-header">
                      <div className="popup-icon-nouvelarrivant"><Icons.Users /></div>
                      <div>
                        <h3 className="popup-title">üëã Nouvel Arrivant</h3>
                        <p className="popup-text">{infoNouvelArrivant}</p>
                      </div>
                    </div>
                    <button onClick={() => setShowInfo(null)} className="btn-nouvelarrivant" style={{width: '100%'}}>Fermer</button>
                  </div>
                </div>
              )}
              
              {showInfo === 'service-public' && (
                <div className="popup-overlay" onClick={() => setShowInfo(null)}>
                  <div className="popup-card" onClick={(e) => e.stopPropagation()}>
                    <div className="popup-header">
                      <div className="popup-icon-servicepublic"><Icons.Building2 /></div>
                      <div>
                        <h3 className="popup-title">üè¢ Paniers Service Public</h3>
                        <p className="popup-text">{infoServicePublic}</p>
                      </div>
                    </div>
                    <button onClick={() => setShowInfo(null)} className="btn-servicepublic" style={{width: '100%'}}>Fermer</button>
                  </div>
                </div>
              )}

              {selectedProduct && (
                <div className="popup-overlay" onClick={() => setSelectedProduct(null)}>
                  <div className="popup-card" onClick={(e) => e.stopPropagation()}>
                    <div className="popup-header">
                      <div className="popup-icon-productinfo"><Icons.Info /></div>
                      <div>
                        <h3 className="popup-title">‚ÑπÔ∏è {selectedProduct.name}</h3>
                        <p className="popup-text">{selectedProduct.info || "Aucune information disponible pour ce produit."}</p>
                      </div>
                    </div>
                    <button onClick={() => setSelectedProduct(null)} className="btn-nouvelarrivant" style={{width: '100%'}}>Fermer</button>
                  </div>
                </div>
              )}

              {copied && (
                <div className="copy-message">
                  <Icons.CheckCircle />
                  <span>{copiedMessage}</span>
                </div>
              )}

              <div className="categories-container">
                {Object.entries(products).map(([category, items]) => (
                  <div key={category} className="category-card">
                    <button onClick={() => toggleCategory(category)} className="category-header">
                      <div className="category-title-container">
                        <span className="category-emoji">{categoryEmojis[category]}</span>
                        <h2 className="category-title">
                          {category}
                          <span className="category-count">({items.length} produits)</span>
                        </h2>
                      </div>
                      <div className="category-icon">
                        {expandedCategories[category] ? <Icons.ChevronDown /> : <Icons.ChevronRight />}
                      </div>
                    </button>
                    
                    {expandedCategories[category] && (
                      <div className="category-content animate-fadeIn">
                        <div className="product-grid">
                          {items.map((product, idx) => (
                            <div key={idx} className="product-card">
                              <div className="product-header">
                                <div className="product-header-top">
                                  <h3 className="product-name">{product.name}</h3>
                                  <button 
                                    onClick={() => setSelectedProduct(product)} 
                                    className="btn-info-product"
                                  >
                                    i
                                  </button>
                                </div>
                                <p className="product-price">{product.price}$</p>
                                <p className="product-weight">Poids: {product.weight} kg</p>
                              </div>
                              <div className="quantity-controls">
                                <button onClick={() => decrementQuantity(product, category)} className="btn-moins">‚àí</button>
                                <input
                                  type="number"
                                  min="0"
                                  value={getQuantity(product, category)}
                                  onChange={(e) => updateQuantity(product, category, e.target.value)}
                                  className="quantity-input"
                                />
                                <button onClick={() => incrementQuantity(product, category)} className="btn-plus">+</button>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<OutilDevis />);
  </script>
</body>
</html>
